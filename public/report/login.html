<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>REVRUN | 로그인</title>
  <style>
    body {
      margin: 0;
      background: #0b0f19;
      color: #fff;
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
    }
    .box {
      max-width: 420px;
      margin: 100px auto;
      background: #121a2a;
      padding: 24px;
      border-radius: 16px;
    }
    h1 {
      margin: 0 0 16px;
      font-size: 22px;
    }
    input {
      width: 100%;
      padding: 12px;
      margin: 8px 0;
      border-radius: 10px;
      border: 1px solid #2a3550;
      background: #0b0f19;
      color: #fff;
      box-sizing: border-box;
    }
    button {
      width: 100%;
      padding: 12px;
      margin-top: 12px;
      border-radius: 10px;
      border: none;
      background: #4f7cff;
      color: #fff;
      font-weight: 700;
      cursor: pointer;
    }
    .msg {
      margin-top: 12px;
      color: #ffb4b4;
      min-height: 20px;
    }
  </style>
</head>

<body>
  <div class="box">
    <h1>REVRUN 로그인</h1>

    <input id="username" placeholder="아이디 (admin / client1 / client2)" />
    <input id="password" type="password" placeholder="비밀번호" />

    <button id="loginBtn">로그인</button>
    <div class="msg" id="msg"></div>
  </div>

  <!-- ✅ 스크립트는 body 맨 마지막 + 문법 깨끗 -->
  <script>
    const $ = (id) => document.getElementById(id);

    $("loginBtn").addEventListener("click", login);
    $("password").addEventListener("keydown", (e) => {
      if (e.key === "Enter") login();
    });

    async function login() {
      const username = $("username").value.trim();
      const password = $("password").value;
      $("msg").textContent = "";

      if (!username || !password) {
        $("msg").textContent = "아이디랑 비번부터 입력해라 형";
        return;
      }

      try {
        const res = await fetch("/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({ username, password }),
        });

        const data = await res.json().catch(() => ({}));

        if (!res.ok || !data.ok) {
          $("msg").textContent = data.message || "로그인 실패";
          return;
        }

        // 서버에서 내려준 redirect 경로로 이동
        location.href = data.redirect;
      } catch (err) {
        $("msg").textContent = "서버 연결 실패";
      }
    }
  </script>
</body>
</html>
