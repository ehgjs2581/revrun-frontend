<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>REVRUN | 광고 성과 리포트</title>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
  <style>
    /* ========================================
       모바일 퍼스트 기본 스타일
    ======================================== */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --cream: #faf8f5;
      --light-cream: #f5f3ef;
      --warm-beige: #e8e3db;
      --medium-brown: #8b7355;
      --dark-brown: #5d4a3a;
      --deep-brown: #3a2f23;
      --accent-green: #22c55e;
      --accent-green-light: #dcfce7;
      --accent-pink: #c4a4a4;
    }
    
    body {
      font-family: 'Manrope', -apple-system, sans-serif;
      background: var(--cream);
      color: var(--deep-brown);
      line-height: 1.6;
    }
    
    /* 컨테이너 - 모바일 기본 */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 16px;
    }
    
    /* ========================================
       헤더 - 모바일: 세로 중앙, PC: 가로 양끝
    ======================================== */
    .header {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 16px;
      margin-bottom: 24px;
      padding-bottom: 20px;
      border-bottom: 1px solid var(--warm-beige);
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo {
      width: 40px;
      height: 40px;
      background: var(--deep-brown);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 14px;
      color: var(--cream);
    }
    
    .brand-info h1 { font-size: 18px; font-weight: 700; color: var(--deep-brown); }
    .brand-info span { font-size: 12px; color: var(--medium-brown); }
    
    .user-area {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .user-name { font-size: 13px; font-weight: 600; color: var(--dark-brown); }
    
    .btn-logout {
      padding: 8px 16px;
      border: 1px solid var(--deep-brown);
      background: transparent;
      color: var(--deep-brown);
      font-weight: 600;
      font-size: 12px;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.3s ease;
    }
    
    .btn-logout:hover { background: var(--deep-brown); color: var(--cream); }
    
    /* ========================================
       페이지 헤더 - 중앙 정렬 (타이틀만)
    ======================================== */
    .page-header {
      text-align: center;
      margin-bottom: 24px;
    }
    
    .page-title { font-size: 22px; font-weight: 800; color: var(--deep-brown); margin-bottom: 4px; }
    .page-meta { font-size: 13px; color: var(--medium-brown); }
    
    /* ========================================
       카드 - 좌측 정렬 기본
    ======================================== */
    .card {
      background: white;
      border: 1px solid var(--warm-beige);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }
    
    .card-title {
      font-size: 14px;
      font-weight: 700;
      color: var(--deep-brown);
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--warm-beige);
      display: flex;
      align-items: center;
      gap: 8px;
      text-align: left;
    }
    
    .card-title lottie-player { width: 24px; height: 24px; }
    
    .card-header {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--warm-beige);
    }
    
    .card-title-inline {
      font-size: 14px;
      font-weight: 700;
      color: var(--deep-brown);
      display: flex;
      align-items: center;
      gap: 8px;
      margin: 0;
    }
    
    .card-title-inline lottie-player { width: 24px; height: 24px; }
    
    /* ========================================
       2열 그리드 - 모바일에서도 2열 유지 (KPI/비교 데이터)
    ======================================== */
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    
    /* 1열 스택 - 설명형 텍스트/리스트/이미지만 */
    .stack-1 {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    /* ========================================
       통계 박스 - 모바일 최적화
    ======================================== */
    .stat-box {
      background: var(--light-cream);
      border-radius: 10px;
      padding: 14px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 0; /* 오버플로우 방지 */
    }
    
    .stat-label { font-size: 12px; color: var(--dark-brown); font-weight: 500; text-align: left; }
    .stat-sub { font-size: 10px; color: var(--medium-brown); margin-top: 2px; }
    
    .stat-value-wrap {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 6px;
      flex-wrap: wrap; /* 숫자 길면 줄바꿈 */
    }
    
    .stat-value { 
      font-size: 18px; 
      font-weight: 800; 
      color: var(--deep-brown); 
      word-break: break-word; /* 긴 숫자 처리 */
    }
    .stat-value.green { color: var(--accent-green); }
    
    .stat-arrow {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      background: var(--accent-green-light);
      border-radius: 50%;
    }
    
    .stat-arrow lottie-player { width: 20px; height: 20px; }
    
    /* 큰 메트릭 박스 */
    .big-metric-box {
      background: var(--light-cream);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
    }
    
    .big-number-wrap {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 6px;
    }
    
    .big-number { 
      font-size: 24px; 
      font-weight: 800; 
      color: var(--deep-brown); 
      word-break: break-word;
      min-width: 0;
    }
    
    .big-arrow {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      background: var(--accent-green-light);
      border-radius: 50%;
    }
    
    .big-arrow lottie-player { width: 24px; height: 24px; }
    .big-sub { font-size: 11px; color: var(--medium-brown); }
    
    .progress-simple {
      height: 6px;
      background: var(--warm-beige);
      border-radius: 3px;
      margin-top: 12px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent-green), #4ade80);
      border-radius: 3px;
      transition: width 1.5s ease-out;
    }
    
    /* ========================================
       성별 비율 - 2열 유지, 글씨 안 잘림
    ======================================== */
    .gender-box {
      background: var(--light-cream);
      border-radius: 10px;
      padding: 14px;
    }
    
    .gender-label { font-size: 12px; color: var(--dark-brown); font-weight: 500; margin-bottom: 8px; text-align: left; }
    
    .gender-bar {
      display: flex;
      height: 32px;
      border-radius: 6px;
      overflow: visible;
    }
    
    .gender-male, .gender-female {
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 11px;
      font-weight: 600;
      white-space: nowrap;
      min-width: 55px;
      transition: width 1s ease-out;
    }
    
    .gender-male { background: var(--dark-brown); border-radius: 6px 0 0 6px; }
    .gender-female { background: var(--accent-pink); border-radius: 0 6px 6px 0; }
    
    /* ========================================
       연령대 - 좌측 정렬
    ======================================== */
    .age-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }
    
    .age-label { width: 45px; font-size: 11px; color: var(--dark-brown); font-weight: 500; text-align: left; }
    
    .age-bar-bg {
      flex: 1;
      height: 20px;
      background: var(--warm-beige);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .age-bar-fill {
      height: 100%;
      background: var(--medium-brown);
      border-radius: 4px;
      transition: width 1s ease-out;
    }
    
    .age-percent { width: 35px; text-align: right; font-size: 12px; font-weight: 700; color: var(--deep-brown); }
    
    /* ========================================
       네이버 박스 - 2열 구조
    ======================================== */
    .naver-box {
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      border-radius: 10px;
      padding: 16px;
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 12px;
    }
    
    .naver-label {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 13px;
      font-weight: 600;
      color: var(--dark-brown);
      text-align: left;
    }
    
    .naver-icon {
      width: 28px;
      height: 28px;
      background: #03c75a;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 800;
      font-size: 14px;
      flex-shrink: 0;
    }
    
    .naver-icon-small {
      display: inline-flex;
      width: 20px;
      height: 20px;
      background: #03c75a;
      border-radius: 4px;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 800;
      font-size: 10px;
      margin-right: 6px;
      vertical-align: middle;
    }
    
    .naver-value-wrap {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .naver-value { 
      font-size: 20px; 
      font-weight: 800; 
      color: #16a34a; 
      word-break: break-word;
    }
    
    .naver-arrow {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 26px;
      height: 26px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    
    .naver-arrow lottie-player { width: 22px; height: 22px; }
    
    /* ========================================
       기간 탭
    ======================================== */
    .period-tabs {
      display: flex;
      gap: 6px;
      justify-content: flex-start;
    }
    
    .period-tab {
      padding: 6px 12px;
      border: 1px solid var(--warm-beige);
      background: white;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 600;
      color: var(--medium-brown);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .period-tab:hover { border-color: var(--dark-brown); color: var(--dark-brown); }
    .period-tab.active { background: var(--deep-brown); color: white; border-color: var(--deep-brown); }
    
    /* ========================================
       차트
    ======================================== */
    .chart-box {
      background: var(--light-cream);
      border-radius: 10px;
      padding: 12px;
      height: 200px;
    }
    
    /* ========================================
       인사이트 리스트 - 1열 스택 허용
    ======================================== */
    .insight-list { list-style: none; }
    
    .insight-item {
      padding: 12px 0 12px 14px;
      border-left: 2px solid var(--warm-beige);
      margin-bottom: 8px;
      font-size: 13px;
      color: var(--dark-brown);
      line-height: 1.5;
      text-align: left;
      opacity: 0;
      animation: fadeInLeft 0.5s forwards;
    }
    
    .insight-item:nth-child(1) { animation-delay: 0.1s; }
    .insight-item:nth-child(2) { animation-delay: 0.2s; }
    .insight-item:nth-child(3) { animation-delay: 0.3s; }
    
    .insight-item.highlight { border-left-color: var(--accent-green); }
    .insight-item.action { border-left-color: var(--accent-pink); }
    
    /* ========================================
       인스타 링크
    ======================================== */
    .insta-link {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      padding: 14px;
      background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
      border-radius: 10px;
      color: white;
      text-decoration: none;
      font-weight: 600;
      font-size: 13px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    .insta-link:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(188, 24, 136, 0.3); }
    
    /* ========================================
       애니메이션
    ======================================== */
    @keyframes fadeInLeft {
      from { opacity: 0; transform: translateX(-15px); }
      to { opacity: 1; transform: translateX(0); }
    }
    
    @keyframes countUp {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .count-animate { animation: countUp 0.5s ease-out forwards; }
    
    /* ========================================
       태블릿 (768px 이상) - 정보 밀도 증가
    ======================================== */
    @media (min-width: 768px) {
      .container { padding: 24px; }
      
      .header {
        flex-direction: row;
        justify-content: space-between;
        text-align: left;
      }
      
      .logo { width: 44px; height: 44px; font-size: 15px; }
      .brand-info h1 { font-size: 20px; }
      .brand-info span { font-size: 13px; }
      .user-name { font-size: 14px; }
      .btn-logout { padding: 10px 20px; font-size: 13px; }
      
      .page-title { font-size: 26px; }
      .page-meta { font-size: 14px; }
      
      .card { padding: 20px; margin-bottom: 20px; border-radius: 14px; }
      .card-title { font-size: 15px; margin-bottom: 20px; }
      .card-title lottie-player { width: 26px; height: 26px; }
      
      .card-header { flex-direction: row; justify-content: space-between; align-items: center; }
      
      .grid-2 { gap: 16px; }
      
      .stat-box { padding: 18px; flex-direction: row; justify-content: space-between; align-items: center; }
      .stat-label { font-size: 13px; }
      .stat-value { font-size: 20px; }
      
      .big-metric-box { padding: 20px; }
      .big-number { font-size: 36px; }
      .big-arrow { width: 32px; height: 32px; }
      .big-sub { font-size: 13px; }
      
      .gender-bar { height: 36px; }
      .gender-male, .gender-female { font-size: 12px; min-width: 65px; }
      
      .age-label { width: 50px; font-size: 12px; }
      .age-bar-bg { height: 22px; }
      .age-percent { font-size: 13px; }
      
      .naver-box { padding: 20px; }
      .naver-label { font-size: 14px; }
      .naver-icon { width: 32px; height: 32px; font-size: 16px; }
      .naver-value { font-size: 26px; }
      
      .period-tab { padding: 8px 14px; font-size: 13px; }
      
      .chart-box { height: 260px; padding: 16px; }
      
      .insight-item { font-size: 14px; padding: 14px 0 14px 18px; }
      
      .insta-link { padding: 16px; font-size: 14px; }
    }
    
    /* ========================================
       PC (1024px 이상) - 최대 정보 밀도
    ======================================== */
    @media (min-width: 1024px) {
      .container { padding: 48px 32px 80px; }
      
      .header { margin-bottom: 48px; padding-bottom: 32px; }
      .logo { width: 48px; height: 48px; font-size: 16px; border-radius: 12px; }
      .brand-info h1 { font-size: 22px; }
      .user-name { font-size: 14px; }
      .btn-logout { padding: 10px 24px; }
      
      .page-header { margin-bottom: 40px; }
      .page-title { font-size: 28px; }
      
      .card { padding: 28px; margin-bottom: 24px; border-radius: 16px; }
      .card-title { font-size: 16px; margin-bottom: 24px; padding-bottom: 16px; }
      .card-title lottie-player { width: 28px; height: 28px; }
      
      .grid-2 { gap: 24px; }
      
      .stat-box { padding: 20px; border-radius: 12px; }
      .stat-label { font-size: 14px; }
      .stat-sub { font-size: 11px; }
      .stat-value { font-size: 24px; }
      .stat-arrow { width: 28px; height: 28px; }
      .stat-arrow lottie-player { width: 24px; height: 24px; }
      
      .big-metric-box { padding: 24px; }
      .big-number { font-size: 48px; }
      .big-arrow { width: 36px; height: 36px; }
      .big-arrow lottie-player { width: 32px; height: 32px; }
      .big-sub { font-size: 14px; }
      .progress-simple { height: 8px; }
      
      .gender-bar { height: 40px; }
      .gender-male, .gender-female { font-size: 13px; min-width: 70px; }
      
      .age-row { gap: 12px; margin-bottom: 12px; }
      .age-label { width: 60px; font-size: 13px; }
      .age-bar-bg { height: 24px; }
      .age-percent { width: 45px; font-size: 14px; }
      
      .naver-box { padding: 24px; border-radius: 12px; }
      .naver-label { font-size: 16px; gap: 12px; }
      .naver-icon { width: 32px; height: 32px; border-radius: 8px; }
      .naver-icon-small { width: 24px; height: 24px; font-size: 12px; }
      .naver-value { font-size: 28px; }
      .naver-arrow { width: 32px; height: 32px; }
      .naver-arrow lottie-player { width: 28px; height: 28px; }
      
      .period-tab { padding: 8px 16px; }
      
      .chart-box { height: 300px; padding: 24px; border-radius: 12px; }
      
      .insight-item { font-size: 15px; padding: 16px 0 16px 20px; margin-bottom: 12px; }
      
      .insta-link { border-radius: 12px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header class="header">
      <div class="brand">
        <div class="logo">RV</div>
        <div class="brand-info"><h1>REVRUN</h1><span>광고 성과 리포트</span></div>
      </div>
      <div class="user-area">
        <span class="user-name" id="userName">-</span>
        <button class="btn-logout" id="logoutBtn">로그아웃</button>
      </div>
    </header>

    <div class="page-header">
      <h2 class="page-title" id="clientName">성과 리포트</h2>
      <p class="page-meta" id="period">최근 30일 기준</p>
    </div>

    <!-- 광고 효과 - 2열 그리드 유지 -->
    <div class="card">
      <h3 class="card-title">
        <lottie-player src="https://assets2.lottiefiles.com/packages/lf20_kuknoxwl.json" background="transparent" speed="1" loop autoplay></lottie-player>
        광고 효과
      </h3>
      <div class="grid-2" style="margin-bottom: 12px;">
        <div class="stat-box">
          <div>
            <span class="stat-label">광고를 본 사람</span>
            <div class="stat-sub">우리 가게를 알게 된 분들</div>
          </div>
          <div class="stat-value-wrap">
            <span class="stat-value green" id="reach">0</span>
            <div class="stat-arrow">
              <lottie-player src="https://assets5.lottiefiles.com/packages/lf20_yyjaansa.json" background="transparent" speed="1" loop autoplay></lottie-player>
            </div>
          </div>
        </div>
        <div class="big-metric-box">
          <div class="big-number-wrap">
            <span class="big-number" id="impressions">0</span>
            <div class="big-arrow">
              <lottie-player src="https://assets5.lottiefiles.com/packages/lf20_yyjaansa.json" background="transparent" speed="1" loop autoplay></lottie-player>
            </div>
          </div>
          <div class="big-sub">총 노출 횟수</div>
          <div class="progress-simple"><div class="progress-fill" id="impressionBar" style="width: 0%;"></div></div>
        </div>
      </div>
      <div class="grid-2">
        <div class="stat-box">
          <div>
            <span class="stat-label">반응한 사람</span>
            <div class="stat-sub">좋아요, 댓글, 클릭</div>
          </div>
          <div class="stat-value-wrap">
            <span class="stat-value green" id="engagement">0</span>
            <div class="stat-arrow">
              <lottie-player src="https://assets5.lottiefiles.com/packages/lf20_yyjaansa.json" background="transparent" speed="1" loop autoplay></lottie-player>
            </div>
          </div>
        </div>
        <div class="gender-box">
          <div class="gender-label">성별 비율</div>
          <div class="gender-bar">
            <div class="gender-male" id="maleBar" style="width: 50%;">남성 50%</div>
            <div class="gender-female" id="femaleBar" style="width: 50%;">여성 50%</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 연령대 - 좌측 정렬 리스트 -->
    <div class="card">
      <h3 class="card-title">
        <lottie-player src="https://assets3.lottiefiles.com/packages/lf20_v1yudlrx.json" background="transparent" speed="1" loop autoplay></lottie-player>
        연령대별 반응
      </h3>
      <div id="ageChart">
        <div class="age-row"><span class="age-label">10대</span><div class="age-bar-bg"><div class="age-bar-fill" id="age13" style="width: 0%;"></div></div><span class="age-percent" id="age13p">0%</span></div>
        <div class="age-row"><span class="age-label">20대</span><div class="age-bar-bg"><div class="age-bar-fill" id="age18" style="width: 0%;"></div></div><span class="age-percent" id="age18p">0%</span></div>
        <div class="age-row"><span class="age-label">30대</span><div class="age-bar-bg"><div class="age-bar-fill" id="age25" style="width: 0%;"></div></div><span class="age-percent" id="age25p">0%</span></div>
        <div class="age-row"><span class="age-label">40대</span><div class="age-bar-bg"><div class="age-bar-fill" id="age35" style="width: 0%;"></div></div><span class="age-percent" id="age35p">0%</span></div>
        <div class="age-row"><span class="age-label">50대</span><div class="age-bar-bg"><div class="age-bar-fill" id="age45" style="width: 0%;"></div></div><span class="age-percent" id="age45p">0%</span></div>
        <div class="age-row"><span class="age-label">60대+</span><div class="age-bar-bg"><div class="age-bar-fill" id="age55" style="width: 0%;"></div></div><span class="age-percent" id="age55p">0%</span></div>
      </div>
    </div>

    <!-- 네이버 유입 -->
    <div class="card">
      <h3 class="card-title"><span class="naver-icon-small">N</span> 네이버플레이스 유입</h3>
      <div class="naver-box">
        <div class="naver-label">
          <span class="naver-icon">N</span>
          <span>네이버에 내 가게 검색한 사람</span>
        </div>
        <div class="naver-value-wrap">
          <span class="naver-value" id="naverVisit">0</span>
          <div class="naver-arrow">
            <lottie-player src="https://assets5.lottiefiles.com/packages/lf20_yyjaansa.json" background="transparent" speed="1" loop autoplay></lottie-player>
          </div>
        </div>
      </div>
    </div>

    <!-- 일별 추이 -->
    <div class="card">
      <div class="card-header">
        <h3 class="card-title-inline">
          <lottie-player src="https://assets9.lottiefiles.com/packages/lf20_xxlxpaw5.json" background="transparent" speed="1" loop autoplay></lottie-player>
          일별 추이
        </h3>
        <div class="period-tabs">
          <button class="period-tab active" data-days="7">7일</button>
          <button class="period-tab" data-days="30">30일</button>
          <button class="period-tab" data-days="0">전체</button>
        </div>
      </div>
      <div class="chart-box"><canvas id="trendChart"></canvas></div>
    </div>

    <!-- 잘된 점 - 1열 스택 허용 -->
    <div class="card">
      <h3 class="card-title">
        <lottie-player src="https://assets4.lottiefiles.com/packages/lf20_touohxv0.json" background="transparent" speed="1" loop autoplay></lottie-player>
        잘된 점
      </h3>
      <ul class="insight-list" id="highlights"><li class="insight-item highlight">데이터를 불러오는 중...</li></ul>
    </div>

    <!-- 더 좋아지려면 - 1열 스택 허용 -->
    <div class="card">
      <h3 class="card-title">
        <lottie-player src="https://assets8.lottiefiles.com/packages/lf20_swnrn2oy.json" background="transparent" speed="1" loop autoplay></lottie-player>
        더 좋아지려면
      </h3>
      <ul class="insight-list" id="actions"><li class="insight-item action">데이터를 불러오는 중...</li></ul>
    </div>

    <!-- 광고 미리보기 -->
    <div class="card">
      <h3 class="card-title">
        <lottie-player src="https://assets1.lottiefiles.com/packages/lf20_kd5rzej5.json" background="transparent" speed="1" loop autoplay></lottie-player>
        광고 미리보기
      </h3>
      <a href="#" class="insta-link" id="instaLink" target="_blank">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
        인스타그램에서 광고 보기
      </a>
    </div>
  </div>

  <script>
    const AD_ACCOUNT_ID = 'act_543464623056642';
    let userData = null;
    let campaignId = null;

    async function api(path, opts = {}) {
      const res = await fetch(path, { credentials: "include", headers: { "Content-Type": "application/json" }, ...opts });
      return res.json();
    }

    function animateCount(element, target, suffix = '') {
      if (!element || target === null || target === undefined) return;
      const duration = 1500;
      const startTime = performance.now();
      const targetNum = parseInt(target) || 0;
      
      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const easeOut = 1 - Math.pow(1 - progress, 3);
        const current = Math.floor(targetNum * easeOut);
        element.textContent = current.toLocaleString('ko-KR') + suffix;
        if (progress < 1) requestAnimationFrame(update);
        else element.textContent = targetNum.toLocaleString('ko-KR') + suffix;
      }
      element.classList.add('count-animate');
      requestAnimationFrame(update);
    }

    function renderList(id, items, className) {
      const el = document.getElementById(id);
      if (!items || items.length === 0) { 
        el.innerHTML = `<li class="insight-item ${className}">아직 분석 데이터가 없습니다.</li>`; 
        return; 
      }
      el.innerHTML = items.map(item => `<li class="insight-item ${className}">${item}</li>`).join('');
    }

    let chart;
    function renderChart(dailyData) {
      const ctx = document.getElementById("trendChart");
      if (chart) chart.destroy();
      
      let labels = [], data = [];
      if (dailyData && dailyData.length > 0) {
        labels = dailyData.map(d => {
          const date = new Date(d.date);
          return `${date.getMonth() + 1}/${date.getDate()}`;
        });
        data = dailyData.map(d => d.impressions);
      } else {
        labels = ['데이터 없음'];
        data = [0];
      }
      
      chart = new Chart(ctx, {
        type: "line",
        data: { 
          labels, 
          datasets: [{ 
            label: "노출", 
            data, 
            borderColor: "#22c55e", 
            backgroundColor: "rgba(34, 197, 94, 0.1)", 
            fill: true, 
            borderWidth: 2, 
            tension: 0.4, 
            pointRadius: 3,
            pointBackgroundColor: "#22c55e",
            pointBorderColor: "#fff",
            pointBorderWidth: 1
          }] 
        },
        options: { 
          responsive: true, 
          maintainAspectRatio: false, 
          plugins: { legend: { display: false } }, 
          scales: { 
            y: { beginAtZero: true, grid: { color: "#e8e3db" }, ticks: { color: "#8b7355", font: { size: 10 } } }, 
            x: { grid: { display: false }, ticks: { color: "#8b7355", font: { size: 10 } } } 
          } 
        }
      });
    }

    async function loadMetaData(cid) {
      if (!cid) return null;
      try {
        const response = await fetch(`/api/meta/report?action=insights&account_id=${AD_ACCOUNT_ID}`);
        const data = await response.json();
        if (!data.success) return null;
        const campaign = (data.insights || []).find(item => item.campaignId === cid);
        return campaign || null;
      } catch (error) { return null; }
    }

    async function loadDailyData(cid, days = 7) {
      if (!cid) return null;
      try {
        const response = await fetch(`/api/meta/report?action=daily&campaign_id=${cid}&days=${days}`);
        const data = await response.json();
        if (!data.success) return null;
        return data.dailyData || [];
      } catch (error) { return null; }
    }

    async function loadDemographics(cid) {
      if (!cid) return null;
      try {
        const response = await fetch(`/api/meta/report?action=demographics&campaign_id=${cid}`);
        const data = await response.json();
        if (!data.success) return null;
        return data;
      } catch (error) { return null; }
    }

    function updateDemographics(demo) {
      if (!demo) return;
      
      const maleP = demo.gender?.malePercent || 50;
      const femaleP = demo.gender?.femalePercent || 50;
      document.getElementById('maleBar').style.width = maleP + '%';
      document.getElementById('maleBar').textContent = `남성 ${maleP}%`;
      document.getElementById('femaleBar').style.width = femaleP + '%';
      document.getElementById('femaleBar').textContent = `여성 ${femaleP}%`;
      
      const ageMap = {
        '13-17': 'age13',
        '18-24': 'age18', 
        '25-34': 'age25', 
        '35-44': 'age35',
        '45-54': 'age45', 
        '55-64': 'age55',
        '65+': 'age55'
      };
      
      let age55Total = 0;
      
      Object.keys(ageMap).forEach(key => {
        const p = demo.age?.[key]?.percent || 0;
        const targetId = ageMap[key];
        
        if (key === '55-64' || key === '65+') {
          age55Total += p;
        } else {
          const bar = document.getElementById(targetId);
          const pEl = document.getElementById(targetId + 'p');
          if (bar) bar.style.width = p + '%';
          if (pEl) pEl.textContent = p + '%';
        }
      });
      
      const bar55 = document.getElementById('age55');
      const pEl55 = document.getElementById('age55p');
      if (bar55) bar55.style.width = age55Total + '%';
      if (pEl55) pEl55.textContent = age55Total + '%';
    }

    document.querySelectorAll('.period-tab').forEach(tab => {
      tab.addEventListener('click', async function() {
        document.querySelectorAll('.period-tab').forEach(t => t.classList.remove('active'));
        this.classList.add('active');
        const days = parseInt(this.dataset.days);
        const dailyData = await loadDailyData(campaignId, days);
        renderChart(dailyData);
      });
    });

    async function boot() {
      const me = await api("/api/me");
      if (!me?.user) { location.href = "/report/login.html"; return; }
      if (me.user.role === 'admin') { location.href = "/admin/dashboard.html"; return; }

      userData = me.user;
      campaignId = userData.meta_account_id;
      
      document.getElementById("userName").textContent = userData.name || userData.username;
      document.getElementById("clientName").textContent = (userData.name || userData.username) + '님의 리포트';
      document.getElementById("period").textContent = '최근 30일 기준';

      const naverVisitorsExtra = userData.naver_visitors || 0;
      
      const metaData = await loadMetaData(campaignId);
      
      if (metaData) {
        setTimeout(() => {
          animateCount(document.getElementById("reach"), metaData.reach, '명');
          animateCount(document.getElementById("impressions"), metaData.impressions, '');
          animateCount(document.getElementById("engagement"), metaData.clicks, '명');
        }, 300);
        
        setTimeout(() => {
          const progressPercent = Math.min((metaData.impressions / 30000) * 100, 100);
          document.getElementById("impressionBar").style.width = progressPercent + '%';
        }, 800);
        
        const landingPageVisits = (metaData.conversions || 0) + naverVisitorsExtra;
        setTimeout(() => animateCount(document.getElementById("naverVisit"), landingPageVisits, '명'), 500);
      } else {
        animateCount(document.getElementById("naverVisit"), naverVisitorsExtra, '명');
      }

      const demo = await loadDemographics(campaignId);
      setTimeout(() => updateDemographics(demo), 500);

      const instaLink = document.getElementById("instaLink");
      if (userData.instagram_url) {
        instaLink.href = userData.instagram_url;
      } else {
        instaLink.href = "https://www.instagram.com";
      }

      const dailyData = await loadDailyData(campaignId, 7);
      renderChart(dailyData);

      let highlights = [], actions = [];
      try {
        if (userData.ai_highlights) highlights = JSON.parse(userData.ai_highlights);
        if (userData.ai_actions) actions = JSON.parse(userData.ai_actions);
      } catch (e) {}

      renderList("highlights", highlights, "highlight");
      renderList("actions", actions, "action");
    }

    document.getElementById("logoutBtn").addEventListener("click", async () => { 
      await api("/api/logout", { method: "POST" }); 
      location.href = "/report/login.html"; 
    });
    
    boot();
  </script>
</body>
</html>